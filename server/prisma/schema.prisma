generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
  binaryTargets   = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id         String       @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  username   String?      @unique @db.VarChar
  password   String?      @db.VarChar
  AdminToken AdminToken?
}

model AdminToken {
  id          String  @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user        String  @db.VarChar @unique
  accessToken String? @db.VarChar
  Admin       Admin?  @relation(fields: [user], references: [username])
}

model BannedUsers {
  id        String     @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar 
  community String     @db.VarChar
  user      String     @db.VarChar
  reasonId  String?
  Community Community? @relation(fields: [community], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Comment {
  id   String @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  body String? @db.VarChar
  user String @db.VarChar
  post String @db.VarChar
  Post Post? @relation(fields: [post], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Community {
  id               String               @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  name             String?              @db.VarChar
  description      String?              @db.VarChar
  CommunityUser    CommunityUser[]
  CommunityRequest CommunityRequest[]
  BannedUsers      BannedUsers[]
}

model CommunityRequest {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user        String?    @db.VarChar
  community   String?    @db.VarChar
  requestedAt DateTime?  @default(now()) @db.Timestamp(6)
  message     String?    @db.VarChar
  Community   Community? @relation(fields: [community], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([user, community])
}

model Context {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user       String? @db.VarChar
  ip         String? @db.VarChar
  country    String? @db.VarChar
  city       String? @db.VarChar
  os         String? @db.VarChar
  device     String? @db.VarChar
  deviceType String? @db.VarChar
  isTrusted  Boolean?
}

model Like {
  id   String @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user String @db.VarChar
  post String @db.VarChar
  Post Post? @relation(fields: [post], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([user, post])
}

model Log {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user      String?   @db.VarChar
  context   String?   @db.VarChar
  message   String?   @db.VarChar
  type      Int?
  level     Int?
  timestamp DateTime? @default(now()) @db.Timestamp(6)
  LogLevel  LogLevel? @relation(fields: [level], references: [id], onDelete: Cascade, onUpdate: Cascade)
  LogType   LogType?  @relation(fields: [type], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model PendingPost {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  content           String?            @db.VarChar
  fileUrl           String             @db.VarChar
  community         String             @db.VarChar
  user              String             @db.VarChar
  caption           String?            @db.VarChar
  status            String?            @db.VarChar
  confirmationToken String?            @db.VarChar
  PendingPostStatus PendingPostStatus[]
}

model Post {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  content   String?   @db.VarChar
  fileUrl   String    @db.VarChar
  community String    @db.VarChar
  user      String    @db.VarChar
  caption   String?   @db.VarChar
  Comment   Comment[]
  Like      Like[]
}

model Preferences {
  id                     String   @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user                   String?  @db.VarChar
  enableContextBasedAuth Boolean?
}

model Relationship {
  id        String @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  follower  String @db.VarChar
  following String @db.VarChar
}

model Report {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  reportedBy   String    @db.VarChar
  post         String    @db.VarChar
  community    String    @db.VarChar
  reportReason String?   @db.VarChar
  reportDate   DateTime? @default(now()) @db.Timestamp(6)
}

model Token {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user         String    @db.VarChar @unique
  refreshToken String?   @db.VarChar
  accessToken  String?   @db.VarChar
  createdAt    DateTime? @default(now()) @db.Timestamp(6)
  salt         Int
 User         User      @relation(fields: [user], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model User {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  username        String          @unique @db.VarChar
  firstName       String          @db.VarChar
  lastName        String          @db.VarChar
  email           String          @db.VarChar
  password        String          @db.VarChar
  avatarUrl       String?         @db.VarChar
  bio             String?         @db.VarChar
  createdAt       DateTime?       @default(now()) @db.Timestamp(6)
  isEmailVerified Boolean?        @default(false)
  height          Float?
  weight          Float?
  age             Int?
  CommunityUser   CommunityUser[]
 Token           Token?
}

model UserRoles {
  id            Int            @id @default(autoincrement())
  role          String?        @unique @db.VarChar
  CommunityUser CommunityUser[]
}

model Email {
  id               Int       @id @default(autoincrement())
  email            String?   @db.VarChar
  verificationCode String?   @db.VarChar
  messageId        String?   @db.VarChar
  for              Int?
  createdAt        DateTime? @default(now()) @db.Timestamp(6)
  EmailFor         EmailFor? @relation(fields: [for], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model EmailFor {
  id    Int     @id @default(autoincrement())
  for   String? @db.VarChar
  Email Email[]
}

model Leaderboard {
  id                    String                    @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  community             String                    @db.VarChar
  LeaderboardSubmission LeaderboardSubmission[]
}

model LeaderboardSubmission {
  id                        String                      @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user                      String?                     @db.VarChar
  community                 String?                     @db.VarChar
  entryUrl                  String?                     @db.VarChar
  verifiedBy                String?                     @db.VarChar
  weight                    Int?                    
  type                      Int?
  verifiedAt                DateTime?                   @default(now())
  rank                      Int?
  LeaderboardSubmissionType LeaderboardSubmissionType[]
  Leaderboard               Leaderboard?                @relation(fields: [leaderboardId], references: [id])
  leaderboardId             String?                     @db.VarChar
}

model LeaderboardSubmissionType {
  id                      Int                     @id @default(autoincrement())
  type                    String?                  @db.VarChar
  LeaderboardSubmission   LeaderboardSubmission?   @relation(fields: [leaderboardSubmissionId], references: [id])
  leaderboardSubmissionId String?                  @db.VarChar
}

model PendingPostStatus {
  id          Int         @id @default(autoincrement())
  status      String?     @db.VarChar
  PendingPost PendingPost[]
}

model LogLevel {
  id    Int     @id @default(autoincrement())
  level String? @db.VarChar
  Log   Log[]
}

model LogType {
  id   Int     @id @default(autoincrement())
  type String? @db.VarChar
  Log  Log[]
}

model SuspiciousLogin {
  id                 String  @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  user               String? @db.VarChar
  ip                 String? @db.VarChar
  country            String? @db.VarChar
  city               String? @db.VarChar
  os                 String? @db.VarChar
  device             String? @db.VarChar
  deviceType         String? @db.VarChar
  isTrusted          Boolean?
  unverifiedAttempts Int?
  isBlocked          Boolean?
}

model CommunityUser {
  id         String     @id @default(dbgenerated("gen_random_uuid()")) @db.VarChar
  community  String     @db.VarChar
  user       String     @db.VarChar
  role       Int        
  verifiedAt DateTime?  @default(now())
  Community  Community  @relation(fields: [community], references: [id], onDelete: Cascade, onUpdate: Cascade)
  UserRoles  UserRoles  @relation(fields: [role], references: [id], onDelete: Cascade, onUpdate: Cascade)
  User       User       @relation(fields: [user], references: [id], onDelete: Cascade, onUpdate: Cascade)
}
